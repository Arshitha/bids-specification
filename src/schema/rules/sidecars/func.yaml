#
# Groups of related metadata fields
#
# Assumptions: never need disjunction of selectors
# Assumptions: top-to-bottom overrides is sufficient logic


---
# Task imaging data

# Required fields
MRIFuncRequired:
    selectors:
    - modality == "mri"
    - datatype == "func"
    fields:
        RepetitionTime: required
        VolumeTiming: required
        TaskName:
            level: required
            description_addendum: |
                A recommended convention is to name resting state task using labels
                beginning with `rest`.

# Timing Parameters
MRIFuncTimingParameters:
    selectors:
    - modality == "mri"
    - datatype == "func"
    fields:
        NumberOfVolumesDiscardedByScanner: recommended
        NumberOfVolumesDiscardedByUser: recommended
        DelayTime: recommended
        AcquisitionDuration:
            level: recommended
            level_addendum: |
                required for sequences that are described with the `VolumeTiming`
                field and that do not have the `SliceTiming` field set to allow for
                accurate calculation of "acquisition time"
            issue:
                name: VOLUME_TIMING_MISSING_ACQUISITION_DURATION
                message: |
                    The field 'VolumeTiming' requires 'AcquisitionDuration' or 'SliceTiming' to be defined.
        DelayAfterTrigger: recommended

# The mutual exclusion table, spread across 5 definitions
# NOTE: This introduces a prohibited level
MRIFuncTimingParametersMutualExclusion1:
    selectors:
    - modality == "mri"
    - datatype == "func"
    - sidecar contains "RepetitionTime"
    fields:
        AcquisitionDuration: prohibited
        VolumeTiming: prohibited

MRIFuncTimingParametersMutualExclusion2:
    selectors:
    - modality == "mri"
    - datatype == "func"
    - sidecar contains "SliceTiming"
    - sidecar contains "VolumeTiming"
    fields:
        RepetitionTime: prohibited
        DelayTime: prohibited

MRIFuncTimingParametersMutualExclusion3:
    selectors:
    - modality == "mri"
    - datatype == "func"
    - sidecar contains "AcquisitionDuration"
    - sidecar contains "VolumeTiming"
    fields:
        RepetitionTime: prohibited
        DelayTime: prohibited

MRIFuncTimingParametersMutualExclusion4:
    selectors:
    - modality == "mri"
    - datatype == "func"
    - sidecar contains "RepetitionTime"
    - sidecar contains "SliceTiming"
    fields:
        AcquisitionDuration: prohibited
        VolumeTiming: prohibited

MRIFuncTimingParametersMutualExclusion5:
    selectors:
    - modality == "mri"
    - datatype == "func"
    - sidecar contains "RepetitionTime"
    - sidecar contains "DelayTime"
    fields:
        AcquisitionDuration: prohibited
        VolumeTiming: prohibited

# fMRI task information
MRIFuncTaskInformation:
    selectors:
    - modality == "mri"
    - datatype == "func"
    fields:
        Instructions:
            level: recommended
            description_addendum: |
                This is especially important in context of resting state recordings and
                distinguishing between eyes open and eyes closed paradigms.
        TaskDescription: recommended
        CogAtlasID: recommended
        CogPOID: recommended
