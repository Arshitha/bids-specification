---
CommonDerivativeFields:
    selectors:
    - dataset.DatasetType == "derivative"
    fields:
    - Description: RECOMMENDED
    - Sources: OPTIONAL
    - RawSources: OPTIONAL

SpatialReference:
    selectors:
    - dataset.DatasetType == "derivative"
    # - this file can use space entity
    - datatype_rules_match.entities contains "space"
SpatialReferenceEntity:
    selectors:
    - dataset.DatasetType == "derivative"
    - entities contains "space"
    fields:
        SpatialReference: RECOMMENDED
SpatialReferenceNonStandard:
    selectors:
    - dataset.DatasetType == "derivative"
    - not(entities.space in schema.objects.metadata._StandardTemplateCoordSys)
    fields:
        SpatialReference: REQUIRED
SpatialReferenceNoEntity:
    selectors:
    - dataset.DatasetType == "derivative"
    - not(entities contains "space")
    fields:
        SpatialReference: REQUIRED

# this needs to come before density and resolution overrides selected in a
# different way
MaskDerivatives:
    selectors:
    - dataset.DatasetType == "derivative"
    - datatype_rules_match.name is "mask"
    fields:
        RawSources: REQUIRED
        Type: RECOMMENDED
        Atlas: OPTIONAL 
        Resolution: OPTIONAL
        Density: OPTIONAL

MaskDerivativesAtlas:
    selectors:
    - dataset.DatasetType == "derivative"
    - datatype_rules_match.name is "mask"
    - entities contains "label"
    fields:
        atlas: RECOMMENDED

SegmentationCommon
    selectors:
    - dataset.DatasetType == "derivative"
    # isSegmentation?
    fields: 
        Type: RECOMMENDED
        Atlas: OPTIONAL 
        Resolution: OPTIONAL
        Density: OPTIONAL


# Derivatives -> Imaging data types
ImageDerivatives:
    selectors:
    - dataset.DatasetType == "derivative"
    - modality in ["mri", "pet"]
    - extension in [".nii", ".nii.gz"]
    fields:
        SkullStripped: REQUIRED
ImageDerivativeResEntity:
    selectors:
    - dataset.DatasetType == "derivative"
    - modality in ["mri", "pet"]
    - extension in [".nii", ".nii.gz"]
    - entities contains "res"
    fields:
        Resolution: REQUIRED
ImageDerivativeDenEntity:
    selectors:
    - dataset.DatasetType == "derivative"
    - modality in ["mri", "pet"]
    - extension in [".nii", ".nii.gz"]
    - entities contains "den"
    fields:
        Density: REQUIRED

       
